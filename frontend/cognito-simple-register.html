<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - MealMate</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="header">
        <a href="index.html" class="logo">MealMate</a>
        <div class="auth-buttons">
            <a href="cognito-simple-login.html" class="btn btn-signin">Sign In</a>
        </div>
    </header>

    <main class="main-content">
        <section class="welcome-section">
            <div style="max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <h1 class="welcome-title">Create Account</h1>
            <form id="registerForm">
                <div style="margin-bottom: 15px;">
                    <label for="name">Full Name:</label>
                    <input type="text" id="name" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="email">Email:</label>
                    <input type="email" id="email" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="password">Password:</label>
                    <input type="password" id="password" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <small>Must be at least 8 characters with uppercase, lowercase, and numbers</small>
                </div>
                <button type="submit" style="width: 100%; padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">Create Account</button>
            </form>
            
            <div id="verificationSection" style="display: none; margin-top: 20px;">
                <h3>Verify Your Email</h3>
                <p>Please enter the verification code sent to your email:</p>
                <input type="text" id="verificationCode" placeholder="Verification Code" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                <button id="verifyBtn" style="width: 100%; padding: 10px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer;">Verify</button>
            </div>
            
            <div id="message" style="margin-top: 15px; padding: 10px; border-radius: 4px; display: none;"></div>
                <p style="text-align: center; margin-top: 20px;">
                    Already have an account? <a href="cognito-simple-login.html" style="color: #3498db;">Sign in</a>
                </p>
            </div>
        </section>
    </main>

    <script src="https://unpkg.com/amazon-cognito-identity-js@6.3.12/dist/amazon-cognito-identity.min.js"></script>
    <script src="aws-config.js"></script>
    <script>
        let cognitoUser;
        
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const messageDiv = document.getElementById('message');
                
                messageDiv.style.display = 'block';
                messageDiv.style.backgroundColor = '#e3f2fd';
                messageDiv.style.color = '#1976d2';
                messageDiv.textContent = 'Creating account...';
                
                const userPool = new AmazonCognitoIdentity.CognitoUserPool({
                    UserPoolId: cognitoConfig.UserPoolId,
                    ClientId: cognitoConfig.ClientId
                });
                
                const attributeList = [
                    new AmazonCognitoIdentity.CognitoUserAttribute({
                        Name: 'email',
                        Value: email
                    }),
                    new AmazonCognitoIdentity.CognitoUserAttribute({
                        Name: 'name',
                        Value: name
                    })
                ];
                
                userPool.signUp(email, password, attributeList, null, function(err, result) {
                    if (err) {
                        messageDiv.style.backgroundColor = '#ffebee';
                        messageDiv.style.color = '#c62828';
                        messageDiv.textContent = err.message;
                        return;
                    }
                    
                    cognitoUser = result.user;
                    messageDiv.style.backgroundColor = '#e8f5e9';
                    messageDiv.style.color = '#2e7d32';
                    messageDiv.textContent = `Account created! Check ${email} for verification code.`;
                    
                    document.getElementById('registerForm').style.display = 'none';
                    document.getElementById('verificationSection').style.display = 'block';
                });
            });
            
            document.getElementById('verifyBtn').addEventListener('click', function() {
                const verificationCode = document.getElementById('verificationCode').value;
                const messageDiv = document.getElementById('message');
                
                cognitoUser.confirmRegistration(verificationCode, true, function(err, result) {
                    if (err) {
                        messageDiv.style.backgroundColor = '#ffebee';
                        messageDiv.style.color = '#c62828';
                        messageDiv.textContent = err.message;
                        return;
                    }
                    
                    messageDiv.style.backgroundColor = '#e8f5e9';
                    messageDiv.style.color = '#2e7d32';
                    messageDiv.textContent = 'Verified! Redirecting to login...';
                    
                    setTimeout(() => {
                        window.location.href = 'cognito-simple-login.html';
                    }, 2000);
                });
                });
            }, 500);
        });
    </script>
</body>
</html>